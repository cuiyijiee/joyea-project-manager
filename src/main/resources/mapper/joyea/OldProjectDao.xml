<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="me.cuiyijie.joyea.dao.joyea.OldProjectDao">
    <resultMap id="BaseResultMap" type="me.cuiyijie.joyea.domain.JoyeaProject">

        <id property="fNumber" column="productNumber"/>
        <id property="fRelatingOrderNum" column="orderNumber"/>
        <id property="fRelatingEntrySeq" column="orderSeq"/>
        <id property="fMaterialID" column="FMaterialID"/>
        <id property="fNameL2" column="fname_l2"/>
        <id property="fNumber2" column="mingcheng1"/>
        <id property="cFProjectName" column="CFPROJECTNAME"/>
        <id property="fNumber3" column="mingcheng2"/>
        <id property="cFTaskName" column="cftaskname"/>

    </resultMap>
    <select id="getProjectList" resultMap="BaseResultMap">
        select a.FNumber as        "productNumber",
               a.FRelatingOrderNum "orderNumber",
               a.FRelatingEntrySeq "orderSeq",
               a.FMaterialID,
               b.fname_l2,
               b.fnumber           "mingcheng1",
               d.CFPROJECTNAME,
               d.fnumber           "mingcheng2",
               f.cftaskname
        from T_MM_ManufactureOrder a
                 left join T_BD_MATERIAL b on a.FMaterialID = b.fid
                 left join t_sd_saleorder c on a.FRelatingOrderNum = c.fnumber
                 left join ct_prj_project d on c.CFJYCONTRACTPROJEC = d.fid
                 left join CT_PRE_BOOKENTRYBANDMANUORDER e on e.cfmanuorderid = a.fid
                 left join ct_prj_task f on e.cfassemblytaskid = f.fid
--         where a.fnumber = 'SC14070156'
    </select>

    <select id="selectProject" resultType="me.cuiyijie.joyea.pojo.vo.JoyeaProjectVO">
        SELECT DISTINCT c.FID AS "manufactureId", --生产单号ID
        a.fnumber AS "projectNumber", --项目编号
        a.CFPROJECTNAME AS "projectName", --项目名称
        b.FNUMBER AS "saleOrderNumber", --销售订单编号
        c.FRelatingEntrySeq AS "saleOrderSeq", --销售订单序号
        c.FNUMBER AS "manufactureNumber", --生产编号
        d.fid AS "materialId", --产品ID
        d.fname_l2 AS "materialName", --产品名称
        d.fnumber AS "materialNumber", --产品编号
        f.fnumber AS "taskNumber", --任务编号
        f.cftaskname AS "taskName", --任务名称
        f.cfbegintime AS "taskStartTime", --主任务开始时间
        f.cfendtime AS "taskEndTime", --主任务结束时间
        g.fname_l2 AS "taskCategory", --任务类型
        CASE
        WHEN cup.FID is null THEN 0
        WHEN cup.FID is not null THEN 1
        END
        AS hasUrs
        FROM ct_prj_project a
        LEFT JOIN T_SD_SALEORDER b ON a.FID = b.CFJYCONTRACTPROJEC
        LEFT JOIN T_MM_ManufactureOrder c ON c.FRelatingOrderNum = b.FNUMBER
        LEFT JOIN T_BD_MATERIAL d ON d.FID = c.FMaterialID
        LEFT JOIN CT_PRE_BOOKENTRYBANDMANUORDER e ON e.cfmanuorderid = c.fid
        LEFT JOIN ct_prj_task f ON e.cfassemblytaskid = f.fid
        LEFT JOIN CT_PRJ_TASKCATEGORY g ON F.CFTASKCATEGORYID = g.fid
        LEFT JOIN t_sd_saleorderentry h ON b.fid=h.fparentid AND h.fseq=c.FRelatingEntrySeq
        LEFT JOIN CT_PRE_ContractDE h1 ON h.CFJYCONTRACTENTRYID=h1.fid
        LEFT JOIN CT_PRE_EquipCheckItem h2 ON h1.cfequipmentid=h2.cfequipmentid AND h1.cfstatus=4
        LEFT JOIN CT_URS_ProjectURSDemand cup ON cup.cfsaleprojectid = a.cfsaleprojectid
        WHERE c.FOLDBASESTATUS != '-3' AND h2.fid IS NOT NULL
        <if test="projectNumber != null and projectNumber != ''">
            AND a.FNUMBER LIKE CONCAT('%',CONCAT(#{projectNumber},'%'))
        </if>
        <if test="manufactureNumber != null and manufactureNumber != ''">
            AND c.FNUMBER LIKE CONCAT('%',CONCAT(#{manufactureNumber},'%'))
        </if>
        <if test="materialNumber != null and materialNumber != ''">
            AND d.FNUMBER LIKE CONCAT('%',CONCAT(#{materialNumber},'%'))
        </if>
        <if test="taskCategory != null and taskCategory != ''">
            AND g.fname_l2 = #{taskCategory}
        </if>
        <if test="taskStartTime != null">
            AND f.cfbegintime &gt;= #{taskStartTime,jdbcType=DATE}
        </if>
        <if test="taskEndTime != null">
            AND f.cfendtime &lt;= #{taskEndTime,jdbcType=DATE,jdbcType=DATE}
        </if>
    </select>
</mapper>