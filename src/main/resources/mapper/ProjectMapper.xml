<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="me.cuiyijie.joyea.dao.ProjectDao">
    <resultMap id="BaseResultMap" type="me.cuiyijie.joyea.domain.JoyeaProject">

        <id property="fNumber" column="productNumber"/>
        <id property="fRelatingOrderNum" column="orderNumber"/>
        <id property="fRelatingEntrySeq" column="orderSeq"/>
        <id property="fMaterialID" column="FMaterialID"/>
        <id property="fNameL2" column="fname_l2"/>
        <id property="fNumber2" column="mingcheng1"/>
        <id property="cFProjectName" column="CFPROJECTNAME"/>
        <id property="fNumber3" column="mingcheng2"/>
        <id property="cFTaskName" column="cftaskname"/>

    </resultMap>
    <select id="getProjectList" resultMap="BaseResultMap">
        select a.FNumber as        "productNumber",
               a.FRelatingOrderNum "orderNumber",
               a.FRelatingEntrySeq "orderSeq",
               a.FMaterialID,
               b.fname_l2,
               b.fnumber           "mingcheng1",
               d.CFPROJECTNAME,
               d.fnumber           "mingcheng2",
               f.cftaskname
        from T_MM_ManufactureOrder a
                 left join T_BD_MATERIAL b on a.FMaterialID = b.fid
                 left join t_sd_saleorder c on a.FRelatingOrderNum = c.fnumber
                 left join ct_prj_project d on c.CFJYCONTRACTPROJEC = d.fid
                 left join CT_PRE_BOOKENTRYBANDMANUORDER e on e.cfmanuorderid = a.fid
                 left join ct_prj_task f on e.cfassemblytaskid = f.fid
--         where a.fnumber = 'SC14070156'
    </select>

    <select id="selectProject" resultType="me.cuiyijie.joyea.pojo.vo.JoyeaProjectVO">
        SELECT DISTINCT a.fnumber AS "projectNumber",
        a.CFPROJECTNAME AS "projectName",
        b.FNUMBER AS "saleOrderNumber",
        c.FRelatingEntrySeq AS "saleOrderSeq",
        c.FNUMBER AS "manufactureNumber",
        d.fname_l2 AS "materialName",
        d.fnumber AS "materialNumber",
        f.fnumber AS "taskNumber",
        f.cftaskname AS "taskName",
        f.cfbegintime AS "taskStartTime",
        f.cfendtime AS "taskEndTime",
        g.fname_l2 AS "taskCategory"
        FROM ct_prj_project a
        LEFT JOIN T_SD_SALEORDER b ON a.FID = b.CFJYCONTRACTPROJEC
        LEFT JOIN T_MM_ManufactureOrder c ON c.FRelatingOrderNum = b.FNUMBER
        LEFT JOIN T_BD_MATERIAL d ON d.FID = c.FMaterialID
        LEFT JOIN CT_PRE_BOOKENTRYBANDMANUORDER e ON e.cfmanuorderid = c.fid
        LEFT JOIN ct_prj_task f ON e.cfassemblytaskid = f.fid
        LEFT JOIN CT_PRJ_TASKCATEGORY g ON F.CFTASKCATEGORYID = g.fid
        WHERE c.FOLDBASESTATUS != '-3'
        <if test="manufactureNumber != null and manufactureNumber != ''">
            AND c.FNUMBER LIKE CONCAT('%',CONCAT(#{manufactureNumber},'%'))
        </if>
        <if test="materialNumber != null and materialNumber != ''">
            AND d.FNUMBER LIKE CONCAT('%',CONCAT(#{materialNumber},'%'))
        </if>
        <if test="taskCategory != null and taskCategory != ''">
            AND g.fname_l2 = #{taskCategory}
        </if>
        <if test="taskStartTime != null">
            AND f.cfbegintime &gt;= #{taskStartTime,jdbcType=DATE}
        </if>
        <if test="taskEndTime != null">
            AND f.cfendtime &lt;= #{taskEndTime,jdbcType=DATE,jdbcType=DATE}
        </if>
    </select>
</mapper>